<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <link rel="stylesheet" href="lib/onsen/css/onsenui.css"/>
    <link rel="stylesheet" href="lib/onsen/css/onsen-css-components.css"/>
    <link rel="stylesheet" href="css/app.css"/>
    <script src="lib/onsen/js/onsenui.js"></script>
    <script src="lib/jquery.js"></script>
    <script src="cordova.js"></script>
    <script>
      ons.ready(function() {
          var button = document.getElementById('push-button');
          var myNavigator = document.getElementById('myNavigator');

          myNavigator.addEventListener('init', function(event) {
            var page = event.target;
            if (page.id === 'page2') {
              page.querySelector('ons-toolbar .center').innerHTML = page.data.title;
            }
          });

          button.onclick = function() {
            myNavigator.pushPage('scan.html', {data: {title: 'Page 2'}});
          };
        });

              function scanBarcode() {
                 barcodemin.scanBarcode( function(result) {
                        console.log("barcod id = " + result);
                        console.log("result = " + result);
                        getData(result);
                    }, function(error) {
                        alert("Scanning failed: " + error);
                    }
              );


              }
            function getData(id) {
                    console.log("run function");
                  $.ajax({
                        url: 'http://b2b.webili.ir/web_service/get_data/?action=test&id='+id,
                        data: {},
                        success: function(data) {
                            console.log("geting data ...");
                            var r = JSON.stringify(data);
                            console.log("success " + r);
                            //alert(data[0].name);
                            //var htresult = '<table><tr><td><img height="200px" width="200px" id="theImg" src="'+data[0].image_url+'" /></td></tr><tr><td>Name:'+data[0].name+'</td></tr><tr><td>Mobile:'+data[0].mobile+'</td></tr></table>';
                            //$('#resultDiv').prepend(htresult);
                            $(".card").style.backgroundImage = "url('"+data[0].image_url+"')";
                        },
                        error: function (xhr, ajaxOptions, thrownError) {
                            ons.notification.alert(xhr.status + " " + thrownError);
                            }
                    })
              }
        
        var login = function() {
          var modal = document.getElementById('modal');
          var email = document.getElementById('email').value;
          var password = document.getElementById('password').value;
          var myNavigator = document.getElementById('myNavigator');
            
            modal.show({animation:"fade"});
          $.ajax({
            url: 'http://b2b.webili.ir/web_service/get_data/?action=auth&email='+email+'&password='+password,
            data: {},
            success: function(data) {
                console.log("geting data ...");
                var r = JSON.stringify(data);
                console.log("success " + r);
                //alert(data[0].name);
                if (data=="1") myNavigator.pushPage('scan.html', {data: {title: 'Scan'}});
                else ons.notification.alert(data);
                modal.hide({animation:"fade"});
            },
            error: function (xhr, ajaxOptions, thrownError) {
                 ons.notification.alert(xhr.status + " " + thrownError);
                modal.hide({animation:"fade"});
                }
        })
        };

    </script>
  </head>
  <body>
<ons-navigator id="myNavigator" page="page1.html"></ons-navigator>
<ons-template id="page1.html">
  <ons-page>
    <ons-toolbar>
      <div class="center">Login</div>
    </ons-toolbar>
      <ons-modal id="modal">
         <ons-icon size="40px" spin icon="md-spinner"></ons-icon>
        </ons-modal>
      <ons-button id="push-button">Push page</ons-button>
    <div style="text-align: center; margin-top: 30px;">
        <p>
          <ons-input id="email" modifier="underbar" placeholder="Email" float></ons-input>
        </p>
        <p>
          <ons-input id="password" modifier="underbar" type="password" placeholder="Password" float></ons-input>
        </p>
        <p style="margin-top: 30px;">
          <ons-button onclick="login()">Sign in</ons-button>
        </p>
    </div>
  </ons-page>
</ons-template>
</html>